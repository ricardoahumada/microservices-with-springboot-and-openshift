// =============================================================================
// EJERCICIO: Pipeline CI/CD Declarativo para notificacion-service
// =============================================================================
// Objetivo: Implementar un pipeline completo con agente Kubernetes, 
//           build, test, Docker y despliegue a OpenShift con Helm
// =============================================================================

pipeline {
    // TODO Ejercicio 1: Configurar agente Kubernetes (ver afiliado-service como referencia)
    agent any  // REEMPLAZAR con kubernetes agent

    // TODO Ejercicio 2: Definir parametros del pipeline
    parameters {
        // Implementar parametros aqui
    }

    environment {
        APP_NAME = 'notificacion-service'
        APP_VERSION = '1.0.0'
        // TODO Ejercicio 3: Agregar REGISTRY, OPENSHIFT_PROJECT, IMAGE_TAG
    }

    options {
        // TODO Ejercicio 4: Configurar opciones
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
                // TODO: Obtener GIT_COMMIT_SHORT
            }
        }

        stage('Build & Test') {
            steps {
                // TODO Ejercicio 5: Build con Maven en container
                echo "TODO: Implementar build con Maven"
            }
        }

        stage('Code Analysis') {
            // TODO Ejercicio 6: Condicion when + SonarQube
            steps {
                echo "TODO: Implementar analisis de codigo"
            }
        }

        stage('Docker Build & Push') {
            steps {
                // TODO Ejercicio 7: Docker build y push
                echo "TODO: Implementar Docker build"
            }
        }

        stage('Deploy to OpenShift') {
            steps {
                // TODO Ejercicio 8: Helm deploy
                echo "TODO: Implementar despliegue"
            }
        }

        stage('Verify Deployment') {
            steps {
                // TODO Ejercicio 9: Verificacion
                echo "TODO: Implementar verificacion"
            }
        }

        stage('Production Approval') {
            when {
                expression { false }
            }
            steps {
                // TODO Ejercicio 10: Input para prod
                echo "TODO: Implementar aprobacion"
            }
        }
    }

    post {
        // TODO Ejercicio 11: Post actions
        always {
            echo "Pipeline finished"
        }
    }
}
